## Summary:
Remote Access Trojan [[RAT]] with Command injection capabilities. Opens a listening socket on the infected host known as a [[Bind Shell]].
## Hashes:
- md5: 689FF2C6F94E31ABBA1DDEBF68BE810E
- sha1: 69B8ECF6B7CDE185DAED76D66100B6A31FD1A668
- sha256: 248D491F89A10EC3289EC4CA448B19384464329C442BAC395F680C4F3A345C8C

## Static Analysis
#### Floss Interesting Strings
```
AssertionError
fatal.nim
sysFatal
IOError
io.nim
raiseEIO
writeFile
@cannot open: 
@cannot write string to file
@r+b
@w+b
out of memory
virtualFree failing!
SIGABRT: Abnormal termination.
unknown signal
SIGINT: Interrupted by Ctrl-C.
SIGSEGV: Illegal storage access. (Attempt to read from nil?)
SIGFPE: Arithmetic error.
SIGILL: Illegal operation.
Error: unhandled exception: 
OverflowError
fatal.nim
sysFatal
IndexError
[GC] cannot register thread local variable; too many thread local variables
NilAccessError
could not load: 
could not import: 
RangeError
[GC] cannot register global variable; too many global variables
ObjectConversionError
ReraiseError
DivByZeroError
ObjectAssignmentError
parent
name
procname
line
filename
trace
raiseId
errorCode
@ (invalid data!)
@\10"
@nil
@index out of bounds
@invalid object assignment
@division by zero
@no exception to reraise
@invalid object conversion
@iterators.nim(207, 11) `len(a) == L` the length of the string changed while iterating over it
@0123456789ABCDEF
@ not in 0 .. 
@index 
@index out of bounds, the container is empty
@value out of range: 
@attempt to write to a nil address
@over- or underflow
@[[reraised from:
ValueError
parseutils.nim
integerOutOfRangeError
@Parsed integer outside of valid range
ValueError
strutils.nim
parseInt
invalidFormatString
@invalid format string
inet_ntop
WSAStartup
FormatMessageW
LocalFree
GetLastError
socket
WSAIoctl
closesocket
GetEnvironmentStringsW
FreeEnvironmentStringsW
getaddrinfo
freeaddrinfo
connect
send
select
__WSAFDIsSet
recv
setsockopt
bind
listen
accept
inet_ntoa
getsockname
CreatePipe
SetHandleInformation
CreateNamedPipeW
CreateFileW
GetCurrentProcess
DuplicateHandle
CloseHandle
GetStdHandle
CreateProcessW
ReadFile
WriteFile
WaitForSingleObject
@kernel32
@kernel32
@Ws2_32.dll
@Ws2_32.dll
UnpackError
options.nim
@Can't obtain a value from a `none`
@options.nim(368, 10) `self.isSome` 
Field0
Field1
zonedTimeFromTimeImpl
zonedTimeFromAdjTimeImpl
name
OSError
oserr.nim
raiseOSError
@iterators.nim(207, 11) `len(a) == L` the length of the string changed while iterating over it
@USERPROFILE
@unknown OS error
@Additional info: 
closeImpl
atEndImpl
setPositionImpl
getPositionImpl
readDataStrImpl
readLineImpl
readDataImpl
peekDataImpl
writeDataImpl
flushImpl
data
fProcessHandle
fThreadHandle
inHandle
outHandle
errHandle
inStream
outStream
errStream
exitStatus
exitFlag
options
handle
atTheEnd
poEchoCmd
poUsePath
poEvalCommand
poStdErrToStdOut
poParentStreams
poInteractive
poDaemon
@osproc.nim(721, 17) `poParentStreams notin p.options` API usage error: stream access not allowed when you use 
poParentStreams
@Requested command not found: '$1'. OS error:
@osproc.nim(608, 14) `args.len == 0` 
@\\.\pipe\stdin
@\\.\pipe\stdout
IOError
nativesockets.nim
getSockDomain
AF_UNSPEC
AF_UNIX
AF_INET
AF_INET6
SOCK_STREAM
SOCK_DGRAM
SOCK_RAW
SOCK_SEQPACKET
IPPROTO_TCP
IPPROTO_UDP
IPPROTO_IP
IPPROTO_IPV6
IPPROTO_RAW
IPPROTO_ICMP
IPPROTO_ICMPV6
@Unknown socket family in getSockDomain
@iterators.nim(189, 11) `len(a) == L` the length of the seq changed while iterating over it
Field0
Field1
data
counter
ticks
QueryPerformanceFrequency
QueryPerformanceCounter
@kernel32
@kernel32
IOError
net.nim
dial
TimeoutError
waitFor
ValueError
bindAddr
isBuffered
buffer
currPos
bufLen
lastError
domain
sockType
protocol
@Unknown socket address family and no address specified to bindAddr
@0.0.0.0
@net.nim(1133, 12) `avail <= size - read` 
@recv
@net.nim(1062, 14) `size - read >= chunk` 
@net.nim(1015, 9) `not socket.isClosed` Cannot `recv` on a closed socket
@readLine
@' timed out.
@Call to '
@net.nim(1098, 24) `false` 
@Could not send all data.
@No valid socket error code available
@net.nim(1334, 9) `not socket.isClosed` Cannot `send` on a closed socket
@Couldn't resolve address: 
@net.nim(198, 10) `fd != osInvalidSocket` 
@iterators.nim(207, 11) `len(a) == L` the length of the string changed while iterating over it
@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/
scheme
username
password
hostname
port
path
query
anchor
opaque
@://
@mailto
KeyError
tables.nim
Field0
Field1
Field2
data
counter
@hashcommon.nim(33, 9) `length > counter` 
@tableimpl.nim(118, 10) `isPowerOfTwo(defaultInitialSize)` 
@tableimpl.nim(118, 10) `isPowerOfTwo(initialSize)` 
table
HttpHead
HttpGet
HttpPost
HttpPut
HttpDelete
HttpTrace
HttpOptions
HttpConnect
HttpPatch
data
data
head
tail
count
mask
Field0
Field1
function
next
callbacks
finished
error
errorStackTrace
Field0
Field1
timers
callbacks
ioPort
handles
HttpRequestError
httpclient.nim
newConnection
ProtocolError
httpError
ValueError
requestAux
responseContent
socket
connected
currentURL
headers
maxRedirects
userAgent
timeout
auth
proxy
Field0
Field1
onProgressChanged
contentTotal
contentProgress
oneSecondProgress
lastProgressReport
bodyStream
getBody
version
status
body
@GET
@location header expected
@Location
@307
@303
@302
@301
@close
@Connection
@ got 
@Received length doesn't match expected length. Wanted 
@Got disconnected while trying to read body.
@Content-Length
@Invalid chunk size: 
@Server terminated connection prematurely
@chunked
@Transfer-Encoding
@Connection was closed before full request has been made
@too many headers
@invalid headers
@unsupported http version
@1.0
@1.1
@invalid http version, 
@HTTP/
@connect
@head
@iterators.nim(189, 11) `len(a) == L` the length of the seq changed while iterating over it
@Proxy-Authorization: basic 
@Content-Length: 
@Content-Length
@PATCH
@PUT
@POST
@Connection: Keep-Alive
@Connection
@Host: 
@ HTTP/1.1
@User-Agent
@user-agent
@tables.nim(1103, 13) `len(t) ==
    L` the length of the table changed while iterating over it
@SSL support is not available. Cannot connect over SSL. Compile with -d:ssl to enable.
@https
@No uri scheme supplied.
InternetOpenW
InternetOpenUrlW
@wininet
@wininet
MultiByteToWideChar
@kernel32
@kernel32
MessageBoxW
@user32
@user32
@[+] what command can I run for you
@[+] online
@NO SOUP FOR YOU
@\mscordll.exe
@Nim httpclient/1.0.6
@/msdcorelib.exe
@AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
@intrt explr
@http://serv1.ec2-102-95-13-2-ubuntu.local
```

### Initial Detonation - No internet simulated.
![](_assets/RAT.CmdSocket/nosoup.png)
- *Upon execution an error pop up is received and malware terminates.*


### Detonation with simulated Internet.
![](_assets/RAT.CmdSocket/s1ua.png)

![](_assets/RAT.CmdSocket/s1downloader.png)
- *Second stage is downloaded in form of a PE file msdcorelib.exe*




![](_assets/RAT.CmdSocket/persist.png)
![](_assets/RAT.CmdSocket/persist2.png)
- *Persistence Mechanism*



![](_assets/RAT.CmdSocket/RATlistens.png)
- *TCP Socket in Listening state on port 5555*



![](_assets/RAT.CmdSocket/nc5555.png)
![](_assets/RAT.CmdSocket/ncb64.png)
- *Base64 encoded data from socket on TCP 5555.*



![](_assets/RAT.CmdSocket/c2b64.png)
![](_assets/RAT.CmdSocket/c2decoded.png)
- *Command injection capability*

